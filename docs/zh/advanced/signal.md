# Signalï¼ˆå“åº”å¼ï¼‰

`Signal` æ˜¯ä¸€ä¸ªè½»é‡çº§ã€å·¥ç¨‹åŒ–ã€è‡ªç”¨çº§çš„å“åº”å¼ç³»ç»Ÿå®ç°ï¼Œçµæ„Ÿæ¥æºäº SolidJS çš„å¿ƒæ™ºæ¨¡å‹ï¼Œä½†å®Œå…¨ä½¿ç”¨åŸç”Ÿ JavaScript ç¼–å†™ï¼Œä¸ä¾èµ–æ„å»ºå·¥å…·ï¼ˆå¦‚ Viteã€Rollupï¼‰ã€ä¸ä¾èµ– JSX æˆ–ä»»ä½•æ¡†æ¶ï¼Œé€‚ç”¨äºæµè§ˆå™¨ç¯å¢ƒã€‚

## æ ¸å¿ƒæ¦‚å¿µ

- å“åº”å¼é©±åŠ¨ DOM æ›´æ–°ï¼šæ•°æ®å˜åŒ– â†’ è‡ªåŠ¨è§¦å‘å‰¯ä½œç”¨ï¼ˆeffectï¼‰â†’ æ›´æ–° UIã€‚
- ç»†ç²’åº¦å“åº”ï¼šæ¯ä¸ª `signal` æ˜¯ç‹¬ç«‹çš„å“åº”å•å…ƒï¼Œåªè¿½è¸ª/æ›´æ–°çœŸæ­£ä¾èµ–å®ƒçš„éƒ¨åˆ†ã€‚
- æ— è™šæ‹Ÿ `DOM`ï¼šç›´æ¥æ“ä½œçœŸå® `DOM`ï¼Œé€šè¿‡ç»‘å®šå‡½æ•°ï¼ˆå¦‚ `bindText`ï¼‰å®ç°å£°æ˜å¼æ›´æ–°ã€‚
- å¯ç»„åˆ & å¯åµŒå¥—ï¼šæ”¯æŒ `effect` åµŒå¥—ã€ä½œç”¨åŸŸç®¡ç†ã€é”™è¯¯è¾¹ç•Œç­‰é«˜çº§ç‰¹æ€§ã€‚
- è°ƒåº¦å™¨æ§åˆ¶ï¼šæ”¯æŒ `batch`ã€`startTransition`ã€`flushSync` ç­‰è°ƒåº¦ç­–ç•¥ï¼Œä¼˜åŒ–æ€§èƒ½ã€‚

æ ¸å¿ƒ `API` ä¸å®ç°åŸç†å¦‚ä¸‹ï¼š

## createSignal

```js
createSignal(initialValue);
```

::: tip åŸç†

- è¿”å› `[read, write]` ä¸¤ä¸ªå‡½æ•°ã€‚
- `read()` è¢«è°ƒç”¨æ—¶ï¼Œè‹¥å½“å‰æœ‰ `Listener`ï¼ˆå³æ­£åœ¨è¿è¡Œçš„ `effect`ï¼‰ï¼Œåˆ™å°†å…¶åŠ å…¥è¯¥ `signal` çš„è®¢é˜…è€…é›†åˆ `subs`ã€‚
- `write(newValue)` è§¦å‘æ‰€æœ‰è®¢é˜…è€…é‡æ–°æ‰§è¡Œï¼ˆé€šè¿‡ `schedule(effect)`ï¼‰ã€‚

:::

## createEffect

```js
createEffect(fn);
```

::: tip åŸç†ï¼š

- åˆ›å»ºä¸€ä¸ª `effect` å¯¹è±¡ï¼ŒåŒ…å« `run()` æ–¹æ³•ã€‚
- æ‰§è¡Œ `fn()` æ—¶ï¼Œä¼šè‡ªåŠ¨è¯»å– `signal`ï¼Œä»è€Œå»ºç«‹ä¾èµ–å…³ç³»ã€‚
- å½“ä¾èµ–çš„ `signal` æ›´æ–°ï¼Œ`effect` ä¼šè¢«é‡æ–°è°ƒåº¦æ‰§è¡Œã€‚
- æ”¯æŒè‡ªåŠ¨æ¸…ç†ï¼ˆ`onCleanup`ï¼‰å’ŒåµŒå¥—ä½œç”¨åŸŸã€‚

:::

## createMemo

```js
createMemo(fn);
```

::: tip åŸç†ï¼š

- å†…éƒ¨ç”¨ `createEffect` åŒ…è£¹ `fn`ï¼Œç¼“å­˜ç»“æœã€‚
- åªæœ‰å½“ä¾èµ–çš„ `signal` å€¼å˜åŒ–ï¼ˆé€šè¿‡ `equals` åˆ¤æ–­ï¼‰æ—¶æ‰é‡æ–°è®¡ç®—ã€‚
- è¿”å›çš„æ˜¯ä¸€ä¸ª `åªè¯» signal`ï¼ˆå¯è¢«å…¶ä»– `effect` è¿½è¸ªï¼‰ã€‚

:::

## createStore

```js
createStore(obj);
createDeepStore(obj);
```

::: tip åŸç†ï¼š

- ä½¿ç”¨ `Proxy` æ‹¦æˆªå¯¹è±¡å±æ€§è®¿é—®/èµ‹å€¼ã€‚
- æ¯ä¸ªå±æ€§å¯¹åº”ä¸€ä¸ªå†…éƒ¨ `signal`ã€‚
- `createDeepStore` é€’å½’ä»£ç†åµŒå¥—å¯¹è±¡å’Œæ•°ç»„ï¼Œæ”¯æŒæ·±åº¦å“åº”ã€‚

:::

> ğŸ“Œ æ•°ç»„å˜å¼‚æ–¹æ³•ï¼ˆå¦‚ push, sortï¼‰ä¹Ÿè¢«æ‹¦æˆªå¹¶è§¦å‘æ›´æ–°ã€‚

## createResource

```js
createResource(fetcher, options);
```

::: tip åŸç†ï¼š

- å°è£…å¼‚æ­¥æ•°æ®åŠ è½½ï¼Œè¿”å› `[read, { state, reload }]`ã€‚
- æ”¯æŒ `loading`ã€`error`ã€`data` çŠ¶æ€ã€‚
- å†…ç½®ç«æ€å¤„ç†ï¼ˆåªä¿ç•™æœ€æ–°è¯·æ±‚çš„ç»“æœï¼‰ã€‚
- å¯é…åˆ `createSuspense` å®ç°å¦‚ â€œåŠ è½½ä¸­â€ fallbackã€‚

:::

```js
const [user, { state }] = createResource(() => fetchUser(id));
```

> âš ï¸ è°ƒç”¨ user() æ—¶è‹¥è¿˜åœ¨åŠ è½½ï¼Œä¼š throw Promiseï¼Œç”¨äº Suspenseã€‚

## createSuspense

```js
createSuspense(renderFn, fallback);
```

::: tipåŸç†ï¼š

- æ•è· `renderFn` ä¸­æŠ›å‡ºçš„ Promiseï¼ˆæ¥è‡ª `createResource`ï¼‰ã€‚
- è¿”å› `fallback`ï¼Œå¹¶åœ¨ Promise resolve åé‡æ–°è°ƒåº¦æ¸²æŸ“ã€‚

:::

```js
const view = createSuspense(
  () => html`<div>${user().name}</div>`,
  html`<div>Loading...</div>`,
);
```

> ğŸ”„ ç±»ä¼¼ React Suspenseï¼Œä½†åŸºäº Promise æ•è·ã€‚

## DOM ç»‘å®š

DOM ç»‘å®šå‡½æ•°ï¼Œæ— éœ€æ¨¡æ¿å¼•æ“ã€‚æ‰€æœ‰ç»‘å®šéƒ½é€šè¿‡ `createEffect` è‡ªåŠ¨å“åº”æ•°æ®å˜åŒ–ã€‚

| å‡½æ•°                                            | ç”¨é€”                      |
| ----------------------------------------------- | ------------------------- |
| `bindText(el, signal)`                          | ç»‘å®šæ–‡æœ¬å†…å®¹              |
| `bindAttr(el, name, signal)`                    | ç»‘å®š HTML å±æ€§            |
| `bindStyle(el, name, signal)`                   | ç»‘å®š CSS æ ·å¼             |
| `bindShow(el, signal)`                          | æ§åˆ¶ `display` æ˜¾ç¤º/éšè—  |
| `bindIf(anchor, condition, factory)`            | æ¡ä»¶æ¸²æŸ“ï¼ˆæ’å…¥/ç§»é™¤èŠ‚ç‚¹ï¼‰ |
| `bindList(anchor, listSignal, render, options)` | åˆ—è¡¨æ¸²æŸ“ï¼ˆæ”¯æŒ keyï¼‰      |

## è°ƒåº¦ä¸æ‰¹å¤„ç†

- `batch(fn)`ï¼šæ‰¹é‡æ›´æ–°ï¼Œé¿å…å¤šæ¬¡ effect è§¦å‘ã€‚
- `startTransition(fn)`ï¼šä½ä¼˜å…ˆçº§æ›´æ–°ï¼ˆå¦‚æœç´¢è¾“å…¥ï¼‰ï¼Œä¸é˜»å¡ UIã€‚
- `flushSync(fn)`ï¼šåŒæ­¥å¼ºåˆ¶åˆ·æ–°ï¼ˆç”¨äºäº¤äº’åé¦ˆï¼‰ã€‚

## ä½œç”¨åŸŸä¸ç”Ÿå‘½å‘¨æœŸ

- `createRoot(fn)` / `createScope(fn)`ï¼šåˆ›å»º effect å®¹å™¨ï¼Œç»Ÿä¸€æ¸…ç†ã€‚
- `onCleanup(fn)`ï¼šåœ¨ effect æˆ– scope é”€æ¯æ—¶æ‰§è¡Œæ¸…ç†ã€‚
- `onMount(fn)`ï¼šåœ¨ effect é¦–æ¬¡è¿è¡Œåå¾®ä»»åŠ¡æ‰§è¡Œï¼ˆç±»ä¼¼ç»„ä»¶æŒ‚è½½ï¼‰ã€‚

## é”™è¯¯å¤„ç†

- `createErrorBoundary(fn, fallback)`ï¼šæ•è· effect ä¸­çš„é”™è¯¯ï¼Œæä¾› fallbackã€‚
- `catchError(fn, fallback)`ï¼šç®€å• try-catch åŒ…è£…ã€‚

## é€‚ç”¨åœºæ™¯

- å°å‹ Web åº”ç”¨æˆ–åµŒå…¥å¼ç»„ä»¶
- ä¸æƒ³å¼•å…¥å¤§å‹æ¡†æ¶çš„é¡¹ç›®
- æ„å»ºå¾®å‰ç«¯ä¸­çš„ç‹¬ç«‹æ¨¡å—
- éœ€è¦ç²¾ç»†æ§åˆ¶æ›´æ–°é€»è¾‘çš„åœºæ™¯
